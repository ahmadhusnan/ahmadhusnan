POSTGRES USER MANAGEMENT

------------------------
CREATE READ ONLY USER
------------------------
  
  CREATE USER <READ ONLY USER NAME> WITH PASSWORD '<PASSWORD USER>';
  CREATE ROLE <ROLE NAME>;
  GRANT CONNECT ON DATABASE <DATABASE NAME> TO <ROLE NAME>;
  GRANT USAGE ON SCHEMA <SCHEMA NAME> TO <ROLE NAME>;
  GRANT SELECT ON ALL TABLES IN SCHEMA <SCHEMA NAME> TO <ROLE NAME>;
  GRANT <ROLE NAME> TO <READ ONLY USER NAME>;
  ALTER USER <READ ONLY USER NAME> SET DEFAULT ROLE <ROLE NAME>;

------------------------
CREATE ALL ACCESS USER
------------------------
CREATE USER <ALL ACCESS USER> WITH PASSWORD '<PASSWORD USER>';
CREATE ROLE <ALL ACCESS ROLE>;
GRANT connect ON DATABASE <DATABASE NAME> TO <ROLE NAME>;
GRANT ALL PRIVILEGES ON DATABASE <DATABASE NAME> to <ROLE NAME>;
GRANT ALL on SCHEMA <SCHEMA NAME> TO <ROLE NAME>;
GRANT ALL privileges ON ALL TABLES IN SCHEMA <SCHEMA NAME> TO <ROLE NAME>;
GRANT ALL privileges ON ALL SEQUENCES IN SCHEMA <SCHEMA NAME> TO <ROLE NAME>;

-------------------------
QUERY By Time & Status
-------------------------
select e.submission_date, e."number",
	case 
		when e.last_status = 50 then 'Menunggu Pembayaran'
		when e.last_status = 999 then 'Lunas'
		when e.last_status = 777 then 'Dibatalkan'
		else 'error'
	end as status
from <table name> e 
where e.submission_date >= '2025-05-17 00:00:00.000 +0700' and e.last_status in (50,777,999);

--------------------------
CHANGE OWNERSHIP ALL
--------------------------
ALTER DATABASE <database name> OWNER TO <owner>;

SELECT 'ALTER SCHEMA "'|| schema_name ||'" OWNER TO <owner>;'
FROM information_schema.schemata 
WHERE schema_name NOT IN ('information_schema', 'pg_catalog', 'pg_toast')
ORDER BY schema_name;

SELECT 'ALTER TABLE '|| schemaname || '."' || tablename ||'" OWNER TO <owner>;'
FROM pg_tables WHERE NOT schemaname IN ('pg_catalog', 'information_schema')
ORDER BY schemaname, tablename;

SELECT 'ALTER SEQUENCE '|| sequence_schema || '."' || sequence_name ||'" OWNER TO <owner>;'
FROM information_schema.sequences WHERE NOT sequence_schema IN ('pg_catalog', 'information_schema')
ORDER BY sequence_schema, sequence_name;

SELECT 'ALTER VIEW '|| table_schema || '."' || table_name ||'" OWNER TO <owner>;'
FROM information_schema.views WHERE NOT table_schema IN ('pg_catalog', 'information_schema')
ORDER BY table_schema, table_name;
